import os
from datetime import datetime
from src.generate_sql_inserts import generate_sql_inserts

banner = """
-- SQL generated by wms-data-generator
-- DO NOT EDIT THIS FILE MANUALLY
-- Edit the create-wms-schema.sql file instead
--
-- ğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸšš
-- ğŸšš DELIVEROO (C) 2025 ğŸšš
-- ğŸšš   SHIP THAT SHIT   ğŸšš
-- ğŸšš   SpÃ³Å‚ka Akcyjna   ğŸšš
-- ğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸššğŸšš
--
-- Zatrudniamy! https://shorturl.at/G98Ej
"""

def create_sql_file():
    with open("schema/create-wms-schema.sql", "r", encoding="utf-8") as schema_file:
        create_table_sql = schema_file.read()

    output_dir = "output"
    os.makedirs(output_dir, exist_ok=True)
    timestamp = datetime.now().strftime("%Y%m%d-%H%M%S")
    filename = f"wms-{timestamp}.sql"
    filepath = os.path.join(output_dir, filename)

    # Generate SQL and stats
    result = generate_sql_inserts()
    sql_script = (
        banner
        + "\n\n"
        + create_table_sql.strip()
        + "\n\n"
        + "\n".join(result.lines)
    )
    stats = result.stats

    with open(filepath, "w", encoding="utf-8") as f:
        f.write(sql_script)

    print(f"Generated insert statements in {filepath}")
    print("\nFollowing records have been created:")
    for table, count in stats.items():
        print(f"- {table}: {count}") 